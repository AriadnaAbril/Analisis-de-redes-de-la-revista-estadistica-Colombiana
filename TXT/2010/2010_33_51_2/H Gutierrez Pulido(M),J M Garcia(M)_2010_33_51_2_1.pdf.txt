Verificación y monitoreo de la aleatoriedad de los juegos de números de d dígitos
Universidad de Guadalajara
Abstract
Resumen El interés de este trabajo se centra en el problema de probar la aleatoriedad de los resultados de los juegos de números de d dígitos. Es usual que este problema se aborde con pruebas aproximadas del tipo y otras pruebas de independencia de resultados sucesivos. Pero estas pruebas, tienen entre otras limitantes, el hecho de que requieren muestras grandes. Como alternativa, en este trabajo se detalla una prueba bayesiana basada en el modelo multinomial. Además, para monitorear los resultados de este tipo de juego de azar y detectar en forma oportuna patrones y resultados no aleatorios, se propone la utilización de una carta de control geométrica. Se hace un breve estudio Monte Carlo para comprender mejor las características de la carta propuesta. Como caso práctico se analizan los resultados de 500 sorteos de la lotería mexicana Tris y se detectan problemas de falta de aleatoriedad, tanto con la prueba bayesiana como con la carta de control.
Palabras clave: carta de control, distribución geométrica, distribución multinomial, distribución Dirichlet, lotería, prueba ji-cuadrada.


1       Introducción
La fascinación y afición por los juegos y apuestas de azar tienen profundo arraigo
en la historia de la humanidad, y están documentadas desde los primitivos juegos
de dados en la antigüedad hasta los actuales juegos de póker y apuestas en línea
(ver Schwartz 2003, 2006). El gran interés por los juegos de azar motivó, sobre
todo a partir del siglo XVII, el desarrollo teórico del cálculo de probabilidades.
En la actualidad, con el incremento del tiempo de ocio y la aparición de "casinos
electrónicos", los juegos de azar son una práctica para mucha gente, lo que se
debe reconocer como un riesgo, porque hay personas que alcanzan una adicción
patológica a este tipo de juegos. A esta adicción se le conoce como ludopatía, y
ha llevado a que en diferentes épocas y países, los juegos y apuestas de azar hayan
sido prohibidos. Sin embargo, la tendencia ha sido a liberalizar y reglamentar
lo que hoy sin duda es una industria mundial en la que participan los propios
gobiernos, con la aparición de las loterías nacionales.
    En este contexto, uno de los mayores retos es darle confianza y certeza
al jugador y a la sociedad en cuanto a que los resultados de los sorteos son
aleatorios. Hay dos formas básicas con las que se ha buscado dar tal confianza y
certeza; la primera, controlando el proceso, y para ello se buscan mejores equipos
para realizar los sorteos, mayor uniformidad entre las esferas utilizadas, elección
aleatoria de urnas, sorteos en vivo, etc. La otra forma, es mostrar evidencias
estadísticas de que los resultados se pueden considerar aleatorios. Sobre esto
último, en el Reino Unido, la Comisión Nacional de la Lotería (National Lot-
tery Commission, NLC) reguladora de la Lotería Nacional, tiene un programa
de investigación para comprobar si hay elementos de no aleatoriedad en los
diferentes juegos de la Lotería Nacional del Reino Unido (ver Royal Statistical
Society 2000, 2002 y University of Salford 2004, 2005a, 2005b).
    Adicionalmente, en la literatura especializada en estadística hay diferentes
trabajos que abordan problemas de la aleatoriedad de los juegos de azar y as-
pectos relacionados. Unos enfocados a estudiar juegos de números de d dígitos,
en los que el número ganador se determina por la extracción al azar de d es-
feras, usualmente cada una proveniente de una urna que contiene diez esferas
numeradas con los dígitos: 0, 1, 2, . . . , 9. Otros trabajos se enfocan a los juegos
de lotería del tipo k de N , en los que la combinación ganadora se determina por
la extracción al azar de k esferas sin remplazo de una urna que contiene esferas
similares numeradas del 1 al N . Sobre este tipo de juegos, en Joe (1987) se estu-
dian las posibles distribuciones de un conjunto de k-tuplas, dadas las frecuencias
marginales de los números del 1 al N , y se analizan datos de la lotería Lotto
6/49 de Canadá. En Stern & Cover (1989) se estima la distribución de máxima


                                         2

entropía de los boletos comprados en la lotería Lotto 6/49 de Canadá, buscando
determinar números impopulares para el público. En Joe (1990) se cuestiona
la estrategia de comprar un boleto con una k-tupla de números impopulares.
Por su parte, Johnson & Klotz (1993) desarrollan métodos numéricos para cal-
cular las estimaciones de máxima verosimilitud de las probabilidades para los
diferentes números de una lotería, y dan el estadístico de razón de verosimili-
tud generalizado −2 ln() para probar que los números son equiprobables; estos
métodos los aplican a un conjunto de datos de la lotería Lotto América. En Joe
(1993) se obtiene la modificación del estadístico de prueba ji-cuadrada para pro-
bar la uniformidad de los números del 1 al N , dado que los números se extraen
sin remplazo, y se analizan datos de la lotería Lotto 6/49 de Canadá. Finkelstein
(1995) estima la distribución de frecuencia de los números a los que se les apuesta
en la lotería de California, y prueba la hipótesis de que los números pequeños
son más populares. En Genest, Lockhart & Stephens (2002) se discute el uso
del estadístico χ2 para bondad de ajuste, para probar la equiprobabilidad de la
ocurrencia de números de una lotería, el cual no sigue una distribución χ2 sim-
ple porque los números se extraen sin remplazo, y muestran que su distribución
asintótica es la de una suma ponderada de variables aleatorias χ2 ; este resultado
lo utilizan para comprobar la uniformidad de números ganadores en la lotería
Lotto 6/49 de Canadá. Koning & Vermaat (2002) calculan las probabilidades
de ganar premios y el pago esperado en la Lotto holandesa; también prueban la
hipótesis de que los números y colores se extraen aleatoriamente. Percy (2006)
describe una metodología bayesiana para probar la aleatoriedad de los sorteos
de lotería, y considera el caso de datos de la Lotería Nacional del Reino Unido.
En Coronel-Brizio, Hernández-Montoya, Rapallo & Scalas (2008) se abordan
también las loterías del tipo k/N mediante la obtención de la media y varianza
de la variable aleatoria que representa a los números extraídos; también usan la
distribución hipergeométrica, y sus resultados los aplican a la lotería mexicana
Melate y a la lotería italiana. De esta revisión se desprende que los estudios
estadísticos para los juegos de lotería del tipo k de N son variados; y algunos
han propuesto metodologías para verificar la aleatoriedad de los resultados, y
otros han estudiado la forma en que la gente elige los números a los que les
apuestan.
    En cuanto a los juegos de números de d dígitos, en Clotfelter & Cook (2008)
se usan datos del juego de números de la lotería de Maryland para probar
la hipótesis de que los jugadores de lotería creen que la probabilidad de un
evento disminuye cuando ese evento ha ocurrido recientemente ("la falacia del
jugador"), y lo comprueban mostrando cómo las apuestas por los números que
han ganado recientemente disminuye en los sorteos siguientes. En Teo & Leong
(2002) se estudia el diseño de un mecanismo de control para el manejo de las
apuestas en un juego de números de cuatro dígitos, esto es, para decidir si las
apuestas deben ser aceptadas o rechazadas por el operador que ofrece el juego.
En términos generales, el tema de juegos de números de d dígitos ha recibido
mucha menos atención en la literatura especializada; sin embargo el tipo de
herramientas que se utilizan para probar la aleatoriedad de estos tipo de sorteos
presentan algunos problemas. Por ejemplo, usualmente para verificar la igualdad


                                        3

de la frecuencia de los dígitos o grupos de ellos se aplican pruebas aproximadas,
como la tradicional prueba χ2 , que entre otros inconvenientes requiere tamaños
de muestra grandes para lograr buenas aproximaciones (Cai & Krishnamoorthy
2006); otro problema es que para probar la independencia se aplican usualmente
pruebas que precisan el supuesto de normalidad.
    El objetivo del presente artículo es proponer alternativas de solución a los
dos problemas anteriores. Para el primero, en la sección 2 se propone utilizar
el procedimiento bayesiano basado en la distribución multinomial que no re-
quiere resultados asintóticos. Para el segundo problema, en la sección [3] se
propone el uso de una carta geométrica como alternativa para estar monitore-
ando en tiempo real la aleatoriedad de los resultados de un juego de d dígitos.
Adicionalmente, en la sección 4 se presentan los resultados de un estudio de
simulación mediante el cual se analizan las propiedades de la carta de control
propuesta. En la sección [5] se aplican los procedimientos propuestos a un con-
junto de resultados del sorteo Tris, un juego popular en México, promovido por
una institución pública. Mediante ambos procedimientos se detectan problemas
significativos en la aleatoriedad de dicho sorteo. Por último, en la sección [6] se
hace la discusión y se plantean las conclusiones del trabajo.


2     Igualdad de frecuencia de los dígitos
Una primera forma de probar la aleatoriedad de los resultados de los juegos
de números de d dígitos es ver si hay igualdad de frecuencia de los diferentes
dígitos, ya sea considerando cada urna por separado o todas a la vez. Esto se
puede expresar de manera general, considerando n ensayos independientes ( n
sorteos),
Pm        donde cada esfera tiene probabilidad pi de ser extraída, con pi > 0 y
  i=1 pi = 1, y si Xi es el número de veces que se extrae la esfera i, entonces el
vector X = (X1 , . . . , Xm ) sigue una distribución multinomial con parámetro n
y p, donde p = (p1 , . . . , pm ). La densidad de probabilidades multinomial está
dada por
                                                                     m
                                                          n!        Y
                     f (x1 , . . . , xm ; n, p) =                      pxi
                                                    x1 ! · · · xm ! i=1 i
              Pm
    con n =    i=1 xi . Es de interés probar la siguiente hipótesis

                   H0 : p1 = p1,0 , . . . , pm−1 = pm−1,0
                   Ha : pi ̸= pi,0 para algún i = 1, 2, . . . , m − 1
    donde en el caso del juego de números de d dígitos, m = 10 y pi,0 = 0.1.

2.1    Algunas pruebas basadas en la distribución ji-cuadrada
En Cai & Krishnamoorthy (2006) se analizan varias pruebas para (2) donde se
usa de alguna forma la distribución χ2 . La primer prueba, que es la usual y que
originalmente desarrolló Pearson en 1990, se basa en el estadístico dado por:


                                              4

                                     m              2
                                     X (Xi − npi,0 )
                             χ20 =
                                     i=1
                                                npi,0

    Bajo H0 este estadístico sigue en forma aproximada una distribución χ2m−1
con m − 1 grados de libertad (Cai & Krishnamoorthy 2006), por lo que la
hipótesis nula en (2) se rechaza, con un nivel de significancia de α, si χ20 ≥
χ2α,m−1 .
    Por su parte, la prueba de la razón de verosimilitud se basa en en el estadís-
tico
                                     m                        
                                     X                  Xi
                            R=2            Xi ln
                                     i=1
                                                       npi,0

    que sigue en forma aproximada una distribución χ2m−1 con m − 1 grados de
libertad (Cai & Krishnamoorthy 2006). Nass (1959) propuso otra aproximación
a la distribución de (3), con

                                      cχ20 ∼ χ2v
                                           
   donde c = 2E χ20 / Var χ20 y v = cE χ20 . Estas constantes se obtienen
(ver Cai & Krishnamoorthy 2006), a partir de

                                                       m
                                                                 −1
                                                       X
 E χ20 = m − 1 y Var χ20 = 2(m − 1) − m2 + 2m − 2 /n +
                                               
                                                         (npi,0 )
                                                                    i=1

    Una variante propuesta por Nass (1959), de especial interés en este trabajo,
es cuando se tiene igual probabilidad en las celdas de la distribución multinomial,
es decir, cuando pi,0 = 1/m para todo i. En este caso se hace una corrección
por continuidad para que el estadístico (3) tome la forma siguiente:
                                   Pm
                                          X2 − 1
                             χc = i=1 i
                              2
                                                  −n
                                       (n/m)
    con lo que la varianza de χ2c en (6) toma la forma 2(m − 1)(n − 1)/n.
    Una problemática de estas pruebas para validar la aleatoriedad de los juegos
de azar de d dígitos es que son aproximadas, y requieren valores grandes en el
número de sorteos, lo que restringe su aplicación. En Cai & Krishnamoorthy
(2006) se muestra que las pruebas aproximadas pueden tener un inadecuado
comportamiento para tamaños de muestra pequeños y para pi,0 pequeños, que
serían las situaciones de mayor interés en el caso de juegos de número de d
dígitos, ya que para empezar pi,0 = 0.1.
    Finalmente es importante agregar otras variantes sobre las que existen mu-
chos trabajos en la literatura, que usan la aproximación χ2 para probar la
hipótesis en (2) por el método de intervalos de confianza. Estas variantes con-
sisten en estimar intervalos de confianza simultáneos para las m proporciones
pi del modelo multinomial (ver por ejemplo Sison & Glaz 1995, Hou, Chiang &


                                            5

Tai 2003). El primer trabajo sobre el particular es el de Quesenberry & Hurst
(1964), y una mejora de este, bastante fácil de implementar, es la propuesta por
Goodman (1965), que señala que un intervalo simultáneo aproximado, con una
confianza de 100(1 − α) para cada una de las pi se obtiene con:
                                                                          1/2
                     B + 2xi ± {B [B + 4xi (n − xi ) /n]}
                                   2(n + B)
   donde B es el 100 × (1 − α/m) percentil superior de la distribución χ2 con
un grado de libertad.

2.2    Alternativa bayesiana
Dado el modelo multinomial (1), la verosimilitud correspondiente está dada por
                                                           m
                                                           Y
                          L (p1 , . . . , pm ; n, X) ∝            pxi i
                                                           i=1

   A priori, para el modelo multinomial se puede utilizar su conjugada (Bernardo
& Smith 1994), que es la distribución Dirichlet (m, α) :
                                                           m
                                                  1 Y αi −1
                        π (p1 , . . . , pm ) =           p
                                                 B(α) i=1 i
                   Pm
   donde pi > 0,    i=1 pi = 1, αi > 0, α = (α1 , . . . , αm ) y
                                     Qm
                                          Γ (α )
                                        Pm i
                               B(α) = i=1
                                     Γ ( i=1 αi )
     Con αi = 1 para todo i, se logra una distribución a priori no informativa.
Una propiedad interesante es que si p tiene una distribución Dirichlet (m, α),
entonces laPdistribución marginal de pi es una distribución Beta (αi , α0 − αi ),
                  m
con α0 = i=1 αi . Además la distribución marginal de cualquier sub-vector
de una Dirichlet es también Dirichlet; por ejemplo la distribución marginal de
(pi , pj , 1 − pi − pj ) es Dirichlet (αi , αj , α0 − αi − αj ).
     De (9) y (10) se concluye que la distribución posterior está dada por
                                                  m
                                                  Y             m
                                                                Y
                      π (p1 , . . . , pm | X) ∝         pxi i         piαi −1
                                                  i=1           i=1
                                                  Ym
                                             ∝          piαi +xi −1
                                                  i=1

    que, salvo por una constante, corresponde a una distribución Dirichlet (m, α∗ ),
con α∗ = (α1 + x1 , . . . , αm + xm ). De esta manera, con base en (11) se puede
hacer inferencia para p = (p1 , . . . , pm ), lo que permite explorar la hipótesis
(2) o el caso particular de interés en los juegos de número de d dígitos, donde
m = 10 y pi,0 = 0.1. Para explorar la distribución posterior resulta conveniente


                                            6

obtenerla por simulación; por ejemplo en el software libre R, que se puede bajar
de http://cran.r-project.org junto con el paquete MCMCPack, que al cargarlo
puede generar la distribución posterior con la función M Cmultinomdirichlet x, α∗ , mc,
donde x = (x1 , . . . , xm ) y mc es el número de realizaciones que se quiere de
p | X. También puede ser de utilidad la función ddirichlet (p, α).
    Alternativamente a la simulación se puede recurrir a las expresiones analíti-
cas. Por ejemplo, de acuerdo con lo que se dijo antes, la distribución marginal
                                                             ∗
      Pm de cualquiera de las pi es una Beta (αi + xi , α0 − (αi + xi )), con
posterior
 ∗
α0 = i=1 (αi + xi ). Así, para cualquier pi se tiene que


                                Γ (α0∗ )               i +xi −1          α∗ −(αi +xi )−1
    π (pi | X) =                    ∗               pα
                                                     i          (1 − pi ) 0
                   Γ (αi + xi ) Γ (α0 − (αi + xi ))

    Para explorar esta distribución se puede graficar para alguna i y ver qué
tantas posibilidades se le da a pi = 0.1, ya sea calculando un intervalo de
probabilidad para pi con los cuantiles qγ2 y q1−γ2 de la distribución π (pi | X), o
bien calculando Pr (pi > 0.1 | X) o Pr (pi < 0.1 | X). El procedimiento descrito
también se puede ajustar fácilmente para plantear la aleatoriedad de grupos
de dígitos. Basta hacer los ajustes en el modelo multinomial correspondiente.
El procedimiento descrito no requiere aproximaciones asintóticas, por lo que se
puede aplicar en cualquier momento, además de ser más informativo al obtener
la distribución posterior para p o las pi de interés.


3    Independencia y monitoreo de resultados
Puede pasar que con base en las pruebas de la sección anterior se declare que
la frecuencia con la que ocurre cada dígito es similar; sin embargo esto no es
suficiente para asegurar la aleatoriedad de los resultados, ya que pudieron darse
rachas de sorteos que favorecieran a ciertos dígitos, pero que al combinar toda
la información y resumir las frecuencias, estas rachas queden ocultas. Por ello
se requiere también verificar la independencia entre los resultados sucesivos.
    La forma tradicional de verificar esta independencia es ver los resultados de
una urna a través de los diferentes sorteos como una serie de tiempo, y calcular
la autocorrelación para medir la correlación entre los valores de la serie (ver
Royal Statistical Society 2002). Sea xj una serie de n valores (j = 1, 2, . . . , n),
el coeficiente de autocorrelación simple rk con retardo k, típicamente se estima
con
                                  Pn−k
                                    t=1 (xt − x) (xt+k − x̄)
                           rk =        Pn             2
                                         t=1 (xt − x̄)
    donde x̄ es la media aritmética de la variable x en la serie. Es usual calcular
rk para varios valores de k, usualmente pequeños. Una prueba típica de inde-
pendencia de las series es la de Box & Pierce (1970), que se basa en el siguiente
estadístico:


                                             7

                                            t
                                            X
                                Q(r) = n          rk2
                                            k=1

    que asintóticamente tiene una distribución χ2 con t grados de libertad, por
lo que se rechaza la independencia de la serie si Q(r) > χ21−α . En Ljung & Box
(1978) se propone una modificación a la prueba de Box-Pierce, que tiene un
mejor desempeño cuando se satisface el supuesto de normalidad. La propuesta
se basa en el estadístico
                                           t
                                           X
                        L(r) = n(n + 2)          (n − k)−1 rk2
                                           k=1

    que para n grande se distribuye como χ2t . El que estas pruebas requieran
normalidad, muestras grandes y el hecho de aportar poca evidencia gráfica, son
limitantes importantes para su aplicación práctica en juegos de lotería.
    Una alternativa a las pruebas de independencia sería monitorear los resul-
tados de los sorteos en tiempo real y no un año o dos después, cuando todo es
historia. Es reconocido que las cartas de control son una de las mejores formas
de monitorear procesos repetitivos (Gutiérrez & de la Vara 2009), por lo que
dado que cada sorteo de un juego de azar es una repetición en la realización de
un proceso, se propone monitorear la aleatoriedad de los juegos de azar mediante
cartas de control.
    Una forma práctica e intuitiva de monitorear los resultados de un juego de
números de d dígitos es viendo el dígito que resultó en el más reciente sorteo
y analizar hace cuántos sorteos (ensayos) había aparecido tal dígito; de esta
manera, si Y es el número de ensayos o sorteos que transcurrieron para que
apareciera nuevamente tal dígito, entonces bajo el supuesto de aleatoriedad, Y
tiene una distribución geométrica con parámetro p = 0.1, por lo que

                    f (y | p) = Pr(Y = y | p) = (1 − p)y−1 p
   con y = 1, 2, . . .
   La distribución acumulada está dada por
                                           y
                                           X
           F (y | p) = Pr(Y < y | p) = p         (1 − p)i−1 = 1 − (1 − p)y
                                           i=1

    El límite de control superior (LCS) e inferior (LCI) indican dónde se espera
esté Y bajo el supuesto de aleatoriedad. Si se fija una probabilidad de error
tipo I igual a γ, entonces estos límites se obtienen con Pr(Y > LCS | p) = γ2 y
Pr(Y < LCI | p) = γ2. Sin embargo, con la distribución geométrica con p = 0, 1
se obtiene que P (Y = 1) = 0, 1, por lo que dado que usualmente los valores
de γ son pequeños (el valor más comúnmente usado en control de procesos es
γ = 0, 0027 ), entonces no se debe usar LCI, por lo que Pr(Y > LCS | p) = γ.
De aquí que



                                       8

                   Pr(Y > LCS | p) = 1 − Pr(Y ≤ LCS | p)
                         = 1 − F (LCS + 1 | p)
                         = (1 − p)LCS+1 = γ
  Despejando a LCS de esta última igualdad, se obtiene que el valor aproxi-
mado para el LCS está dado por

                                         ln(γ)
                             LCS =               −1
                                       ln(1 − p)
    Nótese que para la aplicación específica de la carta es necesario partir de
que p = 0.1; si no fuera así, entonces la incertidumbre sobre p la podría aportar
una distribución Beta, y hacer inferencia con la distribución posterior corre-
spondiente. En Gutiérrez (2006) se presenta una versión bayesiana para una
carta de control bajo el supuesto anterior. La versión frecuentista de la carta
geométrica y algunos detalles de su caracterización se pueden consultar en Yang,
Xie, Kuralmani & Tsui (2002).
    Si γ = 0.0027, entonces el límite de control superior LCS se puede tomar
igual a 56, ya que Pr(Y > 56 | p = 0, 1) = 0, 002739. Además de los límites de
control es usual establecer otras zonas que ayudan a detectar otros patrones no
aleatorios en el comportamiento del proceso (ver Gutiérrez & de la Vara 2009).
Sin embargo, en el caso de la carta de control geométrica no es posible utilizar
las zonas típicas debido a la forma de la distribución geométrica, que tiene una
forma exponencial donde acumula las probabilidades más altas a los números
enteros más pequeños.
    Como alternativa se propone generar cinco zonas con una cobertura aproxi-
mada de 0,20 en la probabilidad para los correspondientes valores de Y . Estas
zonas se detallan en la tabla 1 y se han obtenido con el apoyo de la distribu-
ción acumulada (17). Como en el juego de números de d dígitos lo que se
quiere garantizar es la aleatoriedad, entonces esto será equivalente a observar
un proceso (juego) bajo control estadístico en una carta geométrica, en donde
la proporción de puntos en las diferentes zonas a lo largo de la carta de con-
trol sea consistente con la probabilidad indicada en la tabla 1. La separación
de las zonas de la tabla 1 puede darse con el valor medio que las separa, así
lA = 2, 5, lB = 5, 5, lC = 9, 5, lD = 16, 5.
    TABLA 1: Zonas en la carta de control geométrica.

                     Zona    Valores de Y       Probabilidad
                      A         {1, 2}              0,19000
                      B        {3, 4, 5}            0,21951
                      C       {6, 7, 8, 9}          0,20307
                      D      {10, . . . , 16}       0,20212
                      E       {Y ≥ 17}              0,18530

   De esta forma, para monitorear el comportamiento de Y en un juego de
número de d dígitos, la observación se puede centrar en cada una de las urnas


                                         9

con las que usualmente se generan los dígitos del juego. Monitoreando en forma
separada cada urna y llevando un registro (carta) particular para cada dígito -
para ello cada vez que se realice un sorteo se ve qué dígito fue extraído de la urna
bajo análisis-, se analiza cuántos sorteos fueron necesarios para que volviera a
aparecer tal dígito, con lo que en cada sorteo se tiene el valor de Y . Para aplicar
la carta desde el primer sorteo, se puede suponer que en el sorteo cero salieron
todos los dígitos.
    Si se viera un punto fuera del LCS, se deberá ver qué pasó, particularmente
qué dígito i es, porque esto identificará la esfera que ha tardado demasiados
                                                                          P10
sorteos en salir, es decir, esto sugerirá que pi < 0, 1. Al considerar que i=1 pi =
1, y si pi < 0, 1 para algún i, entonces esto implica en contraste que pj > 0, 1
para una o más j = 1, . . . 10, con j ̸= i. Esto, trasladado en la carta de control,
se reflejará en que mientras los valores de Y para la esfera i, Yi , tenderán a ser
más grandes, los valores de Yj tenderán a ser más pequeños. Ambas cosas se
detectarán en las zonas de la carta de control. Esta estructura de dependencia
plantea la necesidad de hacer un monitoreo simultáneo e individualizado para
todas las esferas. Simultáneo en el sentido que se tenga claro que a quien se está
monitoreando es a Y (número de ensayos o sorteos que transcurrieron para que
saliera nuevamente el dígito que acaba de aparecer), pero individualizado porque
se propone que el valor de Y se registre en la celda (carta) que le corresponde
a cada dígito.
    De esta manera en cada carta, para cada dígito, se debe vigilar visualmente
que aproximadamente la quinta parte de los valores de Y caigan en cada una
de las zonas de la carta. Si hay sospechas de que esto no está ocurriendo
para un dígito, porque por ejemplo hay una racha larga de puntos donde los
valores de Y tienden a caer en las últimas zonas de la correspondiente carta
de control; esto también se reflejará en forma opuesta en por lo menos otra
zona de otro dígito, donde se tendrán muchos puntos en las primeras zonas de
la carta de control. Identificado esto, para verificar formalmente las posibles
rachas de puntos que siguen un patrón no aleatorio se tienen dos posibilidades.
En la primera se parte de un modelo multinomial para el dígito i con los cinco
sucesos dados por las zonas de la carta, es decir, un modelo multinomial con
p = (pA , pB , pC , pD , pE ), donde se observan xi veces la esfera i; entonces la
distribución marginal posterior para cualquiera de las pk (con k = A, . . . , E ),
se obtiene a partir de (12), para precisar mejor que quede lo indicado como la
distribución a priori no informativa, αk = 1. Específicamente la distribución es
Beta (1 + wk , 5 + xi − (1 + wk )) :


       π (pk | xi , wk ) =
                      Γ (5 + xi )                             5+x −(1+wk )−1
                                            p1+wk −1 (1 − pk ) i
          Γ (1 + wk ) Γ (5 + xi − (1 + wk )) k

   donde wk es el número de puntos que cayeron en la zona k de la carta de
control para el dígito i. A partir de esta distribución marginal se puede calcular
un intervalo de probabilidad para ver si éste incluye al correspondiente valor de


                                        10

pk dado en la tabla 1. Adicionalmente se pueden combinar dos o más de las
zonas de la tabla 1 y hacer los análisis correspondientes mediante (19).
    El otro criterio para verificar rachas de valores de Y que no sigan un patrón
aleatorio es la aplicación de la distribución binomial. Supóngase que hay una
racha sospechosa donde h de t puntos consecutivos cayeron en la zona k de la
carta geométrica, considerando que la zona k puede ser alguna de las indicadas
en la tabla 1, o bien una combinación de algunas zonas de esta tabla u otras que
reúnan algún otro criterio. Entonces es claro que bajo el supuesto de aleato-
riedad, la probabilidad de que tal racha ocurra está dada por la distribución
binomial (t, pk ), donde pk es la probabilidad de la zona k construida como se
ha indicado. Por tanto
                                          
                                        t                  t−h
                         Pr(h | t) =         phk (1 − pk )
                                        h
    Por ejemplo, supóngase que en la zona A de la carta de control geométrica
para algún dígito caen tres puntos consecutivos, lo que significa que tal dígito
salió como resultado en tres sorteos consecutivos o casi consecutivos. Para
calcular la probabilidad de esto, se tiene que h = 3, t = 3 y pk = 0, 19; y
de acuerdo con (20), la probabilidad de tal racha es igual a 0,006859 . Esta
probabilidad es suficientemente baja como para pasar por alto la situación; por
tanto lo que se sugiere hacer es evaluar de cerca lo que está pasando con el
proceso de aleatorización, como por ejemplo se podrían simular sorteos para
corroborar la sospecha con más datos. En la sección [5 donde se analizan datos
de un caso práctico, se aplica (20) para varias rachas sospechosas.
    Para analizar el funcionamiento de la carta propuesta se hace el siguiente
estudio, y además más adelante se verá el caso práctico del sorteo Tris.


4    Estudio Monte Carlo
Para analizar y visualizar el funcionamiento de la carta geométrica propuesta
en la sección previa se hizo un estudio Monte Carlo. Las rutinas fueron progra-
madas con S-Plus. Se buscó simular lo que ocurre en una urna que contiene diez
esferas numeradas con los dígitos, y en cada sorteo se extrae una. Se asignó una
probabilidad de extracción pi para cada esfera y se simularon 300 mil repeti-
ciones del sorteo. Además de cuantificar la proporción de veces que resultó cada
esfera, se registró el número de sorteos que tuvieron que pasar para que volviera
a salir el mismo resultado, es decir se cuantificó Y , junto con la proporción de
veces, respecto al total de sorteos en que el valor de Y fue superior al límite de
control superior (LCS = 56). Además, para cada esfera se registró la propor-
ción de veces en que el valor de Y cayó en cada una de las zonas de la carta
para cada dígito (tabla 1). En la tabla 2 se reportan los resultados para dos
casos. En el primero se supuso que dos esferas, la 3 y 4 , tenían probabilidades
de ser extraídas de p3 = 0, 07 y p4 = 0, 13, y a las restantes se les asignó una
probabilidad de 0,1 . Se observa que la proporción en la que cada esfera fue
el resultado del sorteo fue muy similar a su correspondiente probabilidad; por


                                       11

ejemplo, el 7,0% de las ocasiones la esfera 3 fue el resultado del sorteo, y la
cuatro un 13,0% de las veces. Por otro lado, en cuanto a los valores de Y en las
zonas A a E para cada esfera, se ve que en el caso de la esfera 3, las proporciones
para las primeras tres zonas fue de 0,138, 0,168 y 0,172 , que son visiblemente
menores a las esperadas, de alrededor de 0,20; en contraste, en la última zona,
la E, tiene una proporción de 0,313 , contra una esperada de 0.185. En otras
palabras la esfera tres tardaba demasiados sorteos en salir. En cuanto a la esfera
4, los resultados son opuestos: más veces cayó Y en las primeras zonas de la
carta y pocas en las últimas; por ejemplo, en la zona E la proporción fue de
0,107 , que es casi la mitad de la esperada bajo aleatoriedad (0, 185). En los
restantes dígitos los resultados en las diferentes zonas son muy similares a los
esperados bajo aleatoriedad.
    Para el segundo caso de la tabla 2 se asignó a la esfera 2 una probabilidad
de ser extraída de p2 = 0, 145, y este aumento respecto a 0,10 se quitó de forma
equitativa al resto de las esferas, con lo que sus probabilidades de extracción
fueron de 0,095. Se observa que la proporción con la que salió cada esfera es
muy similar a la probabilidad asignada, por ejemplo, un 14,5% de las ocasiones
la esfera 2 fue el resultado del sorteo, mientras que las proporciones de los
valores de Y para tal esfera que caen en las zonas A y B son de 0,271 y 0,270
respectivamente, ambas muy por arriba de 0,20. Estos aumentos contrastan con
los datos observados para la zona E, a la que le corresponden sólo el 8,0% de
los valores de Y para la esfera 2. Respecto del resto de las esferas, se nota una
ligera disminución de la proporción de valores de Y para la zona A.
    Con los resultados de las simulaciones de la tabla 2 se ilustra que un in-
cremento en el porcentaje de extracciones de un dígito en particular se puede
detectar, además de en el porcentaje mismo, en la carta de control mediante un
incremento de la proporción de valores de Y que caen en las primeras zonas de
la carta y una baja proporción de valores de Y en las últimas zonas, principal-
mente en la zona E, mientras que cuando se tienen proporciones de extracción
menores a 0,1 , se TABLA 2: Resultados de estudio de simulación para dos
casos seleccionados.




                                        12

                                    Resultado    Puntos fuera     Proporción de puntos en cada zona
                                    del sorteo    del LCS          A      B      C       D       E
 Prob. teórica pi = 0, 1   0,100     0,00027        0,190        0,220 0,203 0,202 0,185
                             1        0,100        0,00027       0,188 0,221 0,203 0,206 0,183
       Resultados            2        0,100        0,00024       0,192 0,219 0,203 0,201 0,186
         para los            3        0,070        0,00119       0,138 0,168 0,172 0,209 0,313
         dígitos,            5        0,130        0,00006       0,245 0,255 0,214 0,179 0,107
     con p3 = 0, 07          6        0,100        0,00025       0,191 0,217 0,204 0,202 0,185
       p4 = 0, 13,           7        0,100        0,00032       0,191 0,220 0,200 0,202 0,186
     y los restantes         8        0,099        0,00028       0,191 0,221 0,201 0,196 0,191
       igual a 0,1           9        0,101        0,00026       0,190 0,219 0,206 0,202 0,183
                             0        0,100        0,00032       0,189 0,219 0,199 0,208 0,185
                             1        0,095        0,00035       0,182 0,211 0,197 0,206 0,204
                             2        0,145        0,00001       0,271 0,270 0,216 0,163 0,080
       Resultados            3        0,095        0,00033       0,184 0,211 0,198 0,206 0,201
         para los            4        0,095        0,00034       0,180 0,216 0,199 0,202 0,203
      dígitos, con           5        0,095        0,00037       0,181 0,215 0,197 0,206 0,201
       p2 = 0, 145           6        0,095        0,00038       0,183 0,215 0,196 0,208 0,198
     y los restantes         7        0,095        0,00037       0,184 0,208 0,203 0,204 0,201
     igual a 0, 095          8        0,094        0,00036       0,179 0,215 0,197 0,203 0,206
                             9        0,095        0,00034       0,182 0,214 0,196 0,203 0,204
                             0        0,095        0,00038       0,197 0,207 0,202 0,207 0,202

    detecta en la carta, con puntos fuera del LCS, mayores proporciones de
valores de Y que caen en las zonas D y E, y una menor proporción para las
primeras zonas de la carta. Las sospechas deben ser validadas con las pruebas
descritas en la subsección 2.2 .
    En relación con el uso del LCS para detectar cambios, primero es importante
puntualizar la probabilidad del error tipo I, que consiste en declarar que ha
habido un cambio cuando en realidad no fue así, por lo que el correspondiente
punto fuera del LCS será una falsa alarma. En la tabla 22 se ha estimado
la proporción de falsas alarmas debido a puntos fuera del LCS. Se ha hecho
respecto al total de sorteos, porque al final de cuentas se está monitoreando
sólo un proceso, y los resultados se reportan de forma separada para cada dígito
como una estrategia para separar fuentes de variabilidad atribuible y así lograr
un mejor monitoreo del proceso. Ante esto, el LCS se ha establecido con γ =
0, 002739, como es usual en cartas de control, de tal forma que en condiciones
de control estadístico (aleatoriedad) se esperaría que entre todos los dígitos sólo
se tuviera esa proporción de falsas alarmas. Si a 0,002739 se le divide entre diez,
entonces se esperaría que cada dígito aporte 0,00027 puntos fuera del LCS. En
la tabla 2 se puede ver que en las esferas que tuvieron pi = 0, 1, su proporción de
puntos fuera está muy cerca de lo esperado, mientras que para las esferas en que
pi < 0, 1 se tienen más puntos fuera, porque tarda más la esfera en salir como
resultado; por ejemplo, para la esfera 3 en el caso 1 , se tiene que la proporción
de puntos fuera fue de 0,00119 , en cambio, si pi > 0, 1, la proporción de puntos
fuera es mucho menor, como se ve en la esfera 4 del caso 1 , donde tal proporción


                                        13

fue de 0,00006 . Por tal razón el tipo de problemas de falta de aleatoriedad que
se detectan con el LCS son aquellos donde pi < 0, 1, y no así cuando pi > 0, 1,
esto último debido a que la carta geométrica no tiene LCI.
    Con lo que se ha dicho respecto al error tipo I, queda claro que la probabilidad
de este error γ, que es con la que se calcula el LCS, se mantendrá respecto al
total de sorteos bajo el supuesto de aleatoriedad, a pesar de que se lleve el
registro por separado de los diferentes dígitos. Además, dadas las limitaciones
del LCS para detectar cambios, es necesario el uso de las cartas para cada dígito
junto con las zonas propuestas en la tabla 1, Esto incrementa la potencia para
detectar problemas mediante la identificación de rachas o patrones con sospecha
de falta de aleatoriedad. Pero para mantener en un nivel bajo la posibilidad de
declarar cambios cuando no los ha habido, error tipo I global, entonces cuando
haya sospechas de una racha no aleatoria en una carta de control para un dígito,
esto deberá ser corroborado con criterios probabilísticos, como los sugeridos en
la sección anterior, con las expresiones (12), (19) y (20).


5    Aplicación al sorteo Tris de México
El sorteo Tris es un juego de d dígitos de la empresa Pronósticos para la Asis-
tencia Pública del gobierno mexicano. Inicialmente el participante seleccionaba
tres dígitos, posteriormente fue cambiado para que la selección fuera de cuatro
dígitos, y en el año 2007 se transformó en un juego de cinco dígitos, con lo cual
el participante forma un número entre 00000 y 99999. El sorteo se realiza en
forma pública, y para extraer las esferas que definen el número premiado se
utiliza un dispositivo electromecánico (urna). Los números ganadores del sorteo
Tris están disponibles en la página www.pronosticos.gob.mx. Para este trabajo
se tomaron los resultados del dígito que formaba las unidades de millar, a la que
se identifica como la urna 4, para un total de 500 sorteos Tris entre el 20/07/1996
(sorteo 2913) y el 28/03/1997 (sorteo 3412). La frecuencia resultante para cada
uno de los dígitos en estos 500 sorteos en la urna 4 se muestra en la tabla 3
    TABla 3: Resultados de 500 sorteos Tris para la urna 4 (unidades de millar).


 Dígito           1       2        3      4       5         6       7       8       9      0
 Frecuencia      48      56       45     52       49       57      56       43     60      34
 Proporción     0,096   0,112    0,09   0,104   0,098    0,114   0,112    0,086   0,12   0,068

    Es evidente que bajo la hipótesis de selección aleatoria de las esferas, cada
dígito tiene una probabilidad teórica de ser seleccionado de 0,1 . Sin embargo,
a primera vista los resultados de la tabla 3 parecen contradecir esta hipótesis,
debido particularmente a los dígitos cero y nueve. Este último salió casi el doble
de veces que el primero. Para confirmar estas sospechas se procede a probar la
hipótesis (2) con m = 10 y pi,0 = 0, 1, mediante las diferentes pruebas aproxi-
madas descritas en la subsección 2.1] Para empezar, la prueba usual basada en
el estadístico (3), donde se tiene que



                                        14

                                    10           2
                                    X  (xi − 50)
                            χ20 =                    = 11, 2
                                    i=1
                                           50

    como el valor crítico es χ20,05,9 = 16, 919, no se rechaza H0 . Este no rechazo se
ve también con el valor- p para (21), que es de 0,2622. Así, esta prueba no aporta
evidencia significativa en contra de la aleatoriedad de los resultados sintetizados
en la tabla 3, Algo similar ocurre con la prueba de la razón de verosimilitud del
estadístico (4), ya que el valor de R = 11, 703, lleva a no rechazar H0 , puesto que
el valor- p correspondiente es igual a 0,2306 . Por su parte, con la prueba de Nass
basada en el estadístico (7), se tiene que χ2c = 11, 18, y dado que los grados de
libertad para la distribución χ2 de referencia son v = 9, 02, entonces esta prueba
tampoco rechaza H0 . En cuanto a los intervalos simultáneos para las diez pi ,
basados en (8), con α = 0, 05, todos incluyen al 0,1 ; por ejemplo los intervalos
para p1 , p9 y p10 están dados, respectivamente, por [0, 065, 0, 139], [0, 085, 0, 167]
y [0, 043, 0, 107], con p10 la probabilidad para el dígito cero. Como todos los
intervalos incluyen a 0,1 , no se rechaza (2) con esta metodología. Es de señalar
que el intervalo para el dígito cero es el que estuvo más cercano de no incluir al
0,1 .
    Para Paplicar el procedimiento bayesiano descrito en la subsección 2.2 se tiene
             10
que n = i=1 xi = 500 y α0∗ = 5 + 500. Un primer asunto de interés es explorar
la distribución conjunta posterior de la probabilidad del dígito cero, p10 , y la del
nueve, p9 . Para ello se hizo una corrida de dos mil simulaciones de la distribución
posterior de p, utilizando el MCMCPack de R, como se indicó en la subsección
2.2. En la parte superior de la figura 1 1 se ve una muestra de la distribución
conjunta posterior de (p10 , p9 ), de donde se aprecia la poca posibilidad que se
le da a que p10 ≥ 01; de hecho, de los dos mil puntos sólo 14 están a la derecha
de la línea vertical p10 = 0, 1, lo que en proporción significa 0,007 . Estas
evidencias refuerzan el hecho de que p10 < 0, 1. Por su parte, la posibilidad de
que p9 > 0, 1 es un poco mayor, ya que de los dos mil puntos 165 están abajo
de la línea horizontal p9 = 0, 1, lo que significa una proporción de 0,0825 .
    Una conclusión similar a la anterior se llega al observar la parte baja de la
figura 1 que muestra la gráfica de contornos con diez cortes de la distribución
posterior de pm = (p10 , p9 , 1 − p10 − p9 ), que de acuerdo con lo establecido en la
subsección 2.2. es Dirichlet (pm , αm ), con αm = (1+34, 1+60, 510−2−34−60).
En esta figura se ve la poca posibilidad que se le da a la región p10 ≥ 0, 1.
    De la misma manera se puede obtener la distribución posterior marginal
(12) para cualquiera de los dígitos, que según lo establecido en la subsección 2.2
es una distribución Beta (1 + xi , 510 − 1 − xi ). Como es de particular interés
hacer inferencia sobre los dígitos nueve y cero, de la tabla 3 se ve que éstos
tuvieron una frecuencia de x9 = 60 y x10 = 34, respectivamente. En la figura
2 se muestra la distribución posterior para estos dos casos, de donde es claro
que en el caso del dígito cero se debe rechazar la idea de que p10 = 0, 1, como
requiere el supuesto de aleatoriedad. Esto se respalda si se calculan interva-
los de probabilidad para p10 con los cuantiles qγ2 y q1−γ2 de la distribución
π (p10 | X). Tomando γ = 0, 05, se obtiene que estos intervalos están dados por


                                           15

[0, 0929, 0, 1491] y [0, 0484, 0, 0921], para p9 y p10 , respectivamente.



    Figura 1: Distribución posterior conjunta para los dígitos cero y nueve.
    Como en el caso del dígito nueve, el valor p9 = 0, 1 está dentro del cor-
respondiente intervalo, en este caso no se alcanza a rechazar la hipótesis de
aleatoriedad, cosa que si ocurre en el caso del dígito cero, ya que p10 = 0, 1 está
fuera del correspondiente intervalo de probabilidad. De hecho la probabilidad
de ver este evento o uno peor respecto a aleatoriedad, se puede obtener calcu-
lando el área en la cola de la distribución marginal posterior, es decir calculando
Pr (p10 > 0, 1 | X) que es igual a 0,0056 . Esto muestra que se tiene una fuerte
evidencia contra la aleatoriedad del sorteo Tris en el período analizando. Mien-
tras que en relación al dígito nueve se tiene que Pr (p9 < 0, 1 | X) = 0, 0807, lo
que da una cierta evidencia en contra de la aleatoriedad, aunque no concluyente
como ya se había puntualizado en la figura 1.



     Figura 2: Distribución marginal posterior para los dígitos cero y nueve. Si se
quisiera un estimador puntual para p9 y p10 , en lugar de los estimadores de in-
tervalo que se han dado antes, se puede calcular la moda de las correspondientes
distribuciones marginales posteriores. Estas modas están dadas por pb9 = 0, 1181
y pb10 = 0, 0669.
     Por lo anterior, contrario a las pruebas tradicionales basadas en aproximar
diferentes estadísticos con la distribución χ2 , el procedimiento bayesiano sí de-
tecta que hay problemas en la aleatoriedad de los resultados del sorteo Tris,
como intuitivamente se esperaba a partir de la tabla 2 con la ventaja adicional
de que se aporta evidencia de la distribución posterior, conjunta o marginal,
para los pi con problemas.
     Para probar la independencia de los resultados del sorteo Tris, con los datos
de la urna del millar de los 500 sorteos se calculó el coeficiente de autocorrelación
rk , para k = 1, . . . , 24, y se obtuvo que el estadístico Box-Pierce de la expresión
(14) toma el siguiente valor:
                                        24
                                        X
                              Q = 500         ri2 = 36, 74
                                        i=1

    que tiene un valor- p = 0, 0464, por lo que con una significancia de α = 0, 05
se rechaza la independencia de los resultados de la serie. Al aplicar la prueba
Ljung-Box con el estadístico (14), se obtiene que L(r) = 38, 00, que tiene un
valor- p = 0, 0346704, por lo que también se rechaza la independencia de la
serie, aunque la evidencia gráfica de la falta de independencia, no reportada en
este trabajo, para toda la serie es poco clara.
    Con el fin de aportar una mejor evidencia gráfica y monitorear el compor-
tamiento a través del tiempo de los resultados del sorteo Tris, primero,c on base
en cada dato de la serie original se calculó Y , es decir se identificó qué dígito


                                         16

fue el resultado y se contó cuántos sorteos fueron necesarios para que volviera a
aparecer tal dígito. Para aplicar la carta desde el primer sorteo, se supuso que
en el sorteo cero salieron todos los dígitos. En la tabla 4 se muestra un extracto
de los valores de Y .
    TaBla 4: Muestra de los valores de Y para los primeros 20 sorteo 5 de Tris.


 Sorteo   1   2   3    4   5   6   7   8    9   10   11   12   13   14   15   16     17   18   19   20
 Dígito   9   9   5    2   3   5   7   1    8    9    9    0   2    5     3   0      2     4    6   1
 Y        1   1   3    4   5   3   7   8    9    8    1   12    9   8    10   4      4    18   19   12

    Con los valores de Y para cada dígito se obtuvieron las correspondientes
cartas de control geométricas. Por ejemplo en la figura 3 se muestran las cartas
de control para los dígitos nueve y cero, que ya se vio tienen problemas de
cumplimiento del supuesto de aleatoriedad, por lo que es de interés ver cómo
lo reflejan las cartas de control. En el caso del dígito cero, el punto 26 con
valor de Y = 60 está fuera del LCS, lo que indica que tuvieron que pasar 60
sorteos para que volviera a salir la esfera del dígito cero en la urna del millar,
lo que no es congruente bajo el supuesto de aleatoriedad en el sorteo. Además,
visualmente parece haber demasiados puntos en la parte alta de la zona E de
la carta. En particular parece sospechoso el que 9 de 34 valores de Y sean
mayores que 22. Para corroborar esta sospecha (racha) mediante la aplicación
de (20), se tiene que h = 9, t = 34, y como la zona bajo sospecha en la carta
está dada por aquellos puntos de Y que son mayores que 22, entonces para
calcular la probabilidad de que un punto caiga en esta zona se puede usar la
distribución geométrica acumulada F (y) de la expresión (17), con p = 0, 1; por
tanto pk = Pr(Y ≥ 23) = 1 − F (23 | p = 0, 1) = 0, 0886, entonces aplicando
(20) se obtiene que la probabilidad de la racha referida es igual a 0,00174 ,
lo que es una probabilidad muy baja. Esto confirma la idea de que p10 <
0, 1 para el dígito cero. Aquí la carta de control hubiese resultado un buen
instrumento de monitoreo del sorteo, ya que hubiera avisado que con frecuencia
pasaban demasiados sorteos en donde la esfera cero no salía como resultado.

    Figura 3: Cartas geométricas para los dígitos cero y nueve del sorteo Tris.
    En la parte baja de la figura 3 se muestra la carta de control para el dígito
nueve, que presentó una situación opuesta a la del dígito cero, ya que los valores
de Y tienden a ser más pequeños; por ejemplo, hubo nueve veces en que Y = 1,
lo que implica que en nueve ocasiones hubo dos sorteos consecutivos donde se
tuvo como resultado al nueve. Además, de las 60 veces que salió el número 9,
en todas Y < 25, y como de acuerdo con (17) se tiene que P (Y < 25) = F (25 |
p = 0, 1) = 0, 9282, al aplicar (20) con h = 60, t = 60 y pk = 0, 9282, se tiene
que la probabilidad de que en los sesenta sorteos ocurra que Y < 25 es igual
a 0,011 , lo que es una baja probabilidad. Lo anterior se suma a la sospecha
de que en el período analizado, el número nueve salía con más frecuencia de lo
esperado. Esto confirma la utilidad de la carta, y en el caso del dígito nueve se
tiene que p9 > 0, 1.


                                       17

    Igualmente se analizó cuántos valores de Y cayeron en cada zona de la corre-
spondiente carta de control para cada dígito. Los resultados de esto se muestran
en la tabla 5. Como por diseño la frecuencia con la que los valores de Y caen
en cada zona para cada dígito es más o menos similar, resaltan los casos de
las esferas 3 y 8 debido a que las primeras zonas de sus respectivas cartas de
control incluyen una cantidad pequeña de puntos. Para evaluar con mayor de-
talle esto, se utiliza (19). Si se parte del supuesto de que p = 0, 1 y si se junta
la información de las zonas A y B, se tiene que pAB = pA + pB = 0, 41 (ver
tabla 1); entonces en el caso del dígito 3 se tendrá que xi = 45 y wk = 5 + 6, y
por lo que la distribución posterior de pAB es Beta con parámetros (12, 37). Al
calcular con esta distribución un intervalo de probabilidad para pAB con una
cobertura de 0,95 , se obtiene que el intervalo es [0, 1364, 0, 3731], que no incluye
a pA + pB = 0, 41, lo que es una evidencia contra el supuesto de que p3 = 0, 1
para la esfera 3 ; esto se ratifica si se calcula Pr (pAB > 0.41 | xi , wk ) = 0, 0068,
lo que sugiere que a través del tiempo Y para la esfera 3 no siguió una distribu-
ción geométrica con p3 = 0, 1, y que más bien parece que p3 < 0, 1 por lo menos
por un período largo, lo que es una evidencia más contra la aleatoriedad del
sorteo Tris.
    En la parte superior de la figura 4 se muestra la carta de control para el
dígito 3 , y la gráfica sugiere dos periodos: el primero con p3 > 0, 1, que va del
punto 1 hasta aproximadamente el 20, donde los valores de Y tienden a que Y
tenga valores pequeños; por ejemplo del punto 14 al 18, se da una racha donde
4 de 5 puntos consecutivos caen en la zona A de la carta; luego aplicando (20)
con h = 4, t = 5 y pk = 0, 19, se tiene que bajo el supuesto de aleatoriedad la
probabilidad de tal racha es de apenas 0,005 . Por el contrario, en la segunda
parte de la carta parece que los valores de Y tienden a ser más grandes; por
ejemplo, en esta segunda parte se da una racha desde el punto 19 hasta el 45
donde ningún valor de Y cayó en la zona A, lo que sugiere que en esta segunda
parte de la carta más bien p3 < 0, 1. Al mezclarse estos dos periodos hacen que
la frecuencia total con la que resultó la esfera 3 no suscite ninguna sospecha de
problemas de aleatoriedad. Lo que ha ocurrido con la esfera 3 muestra la utilidad
de la carta de control geométrica propuesta para monitorear la aleatoriedad de
este tipo de juegos.
    En la carta de control para el dígito 8, que no se presenta aquí y que es otro
caso donde hay pocos valores de Y en las zonas A y B, ocurre algo relativamente
similar a lo del dígito 3 : en los primeros 19 puntos de la carta, 18 caen fuera de
las zonas A y B, lo que bajo el supuesto de aleatoriedad tiene una probabilidad
muy baja de ocurrir de apenas 0,0006. En cambio, en la segunda parte de la
carta los valores de Y fluctúan de la manera esperada.
    En la parte inferior de la figura 4 se muestra la carta de control para el dígito
6 , que presenta un caso opuesto al dígito 3 , ya que hay pocos valores de Y en
las zonas D y E, lo que indica que la esfera 6 tendía a salir demasiado pronto,
por lo que pareciera que p6 > 0, 1 en algunos periodos. Por ejemplo del punto
15 al 38 se presentó una racha donde de 24 puntos sólo uno cayó en la zona E,
lo que tiene una probabilidad de ocurrir de 0,04 . Aunque no es una evidencia
contundente, sí apoya un tanto que p6 > 0, 1 durante ese periodo. En apoyo


                                          18

a esto se destaca visualmente que tres puntos consecutivos de Y cayeron en la
zona A (del 10 al 12), y la probabilidad de que esto ocurra bajo el supuesto de
                        3
aleatoriedad es de (pA ) = (0, 19)3 = 0, 00686, que se puede considerar baja.
    TABla 5: Frecuencia de los valores de Y por zona de la carta para el sorteo
Tris.
                                      Zona
           Puntos fuera
             Dígito         A    B     C     D    E    Total   del LCS

                 1           9   10    10     8   11    48         0

                 2          11   10    16    11    8    56         0

                 3           5    6    13    11   10    45         0

                 4          13   11    11     7   10    52         0

                 5           8    9    12    13    7    49         0

                 6          10   14    16     8    9    57         0

                 7          12   13     9    17    5    56         0

                 8           5    6     9    15    8    43         0

                 9          15   12    13    10   10    60         0

                 0           4    7     6     7   10    34         1


    En suma, más allá del posible incremento del error tipo I al rechazar la
hipótesis de aleatoriedad en el proceso de extracción de las esferas de la urna
del millar en el sorteo Tris al evaluar la aleatoriedad de diferentes rachas, lo que
importa mostrar con las cartas de control de la figura 4 es que para probar la
aleatoriedad de juegos de d dígitos no basta probar la igualdad de la frecuencia
con la que los diferentes dígitos aparecen como resultado, como se hizo en el
caso del sorteo Tris para el dígito 0 y 9 a través de las figuras 1 a 3 sino además
es fundamental monitorear la rapidez con la que los diferentes dígitos aparecen,
y así poder identificar rachas no aleatorias con apoyo de las cinco zonas de la
carta geométrica para cada dígito, o que permitirá actuar con mayor oportu-
nidad y de manera más preventiva. Pero como ya se ha dicho, es importante
evaluar formalmente la aleatoriedad de las rachas sospechosas, para lo cual se
han propuesto las opciones que representan las expresiones (19) y (20).




                                        19

6    Discusión y conclusiones
Verificar la aleatoriedad y legalidad de los resultados de los juegos de azar es
un asunto que toma cada día mayor importancia social, dada la existencia de
estos juegos y sorteos tanto en formato tradicional como en formato electrónico
o en internet. Por ello se justifica profundizar en metodologías estadísticas que
ayuden a verificar tal aleatoriedad. En la revisión bibliográfica hecha para este
trabajo se destaca que los juegos de números del tipo k de N han recibido más
atención por parte de los estadísticos, aunque varias de las pruebas propuestas en
la literatura están basadas en el estadístico χ2 , que requiere tamaños de muestra
grandes para lograr buenas aproximaciones, por lo que sería deseable repensar
procedimientos que no dependen de aproximaciones asintóticas, como las op-
ciones
     Figura 4: Cartas geométricas para los dígitos 3 y 6 del sorteo Tris.
     bayesianas. Además es importante pensar en herramientas para monitorear
en forma cotidiana este tipo de sorteos.
     Por su parte, los juegos de números de d dígitos, preocupación central de
este trabajo, han recibido menos atención, pero también requieren mejores for-
mas de verificar su aleatoriedad, ya que la prueba χ2 , que es el procedimiento
estándar para verificar la igualdad en la frecuencia con la que aparece como re-
sultado cada dígito, depende de aproximaciones asintóticas y precisa tamaños de
muestra grandes. Por ello, como alternativa se propuso en este artículo utilizar
el procedimiento bayesiano basado en un modelo multinomial, lo que permite
hacer inferencia con base en la distribución posterior π(p | X), que es fácilmente
obtenida por simulación. Además se pueden obtener distribuciones posteriores
marginales de una o varias proporciones que se quieran analizar con mayor de-
talle. Esta alternativa, aparte de no requerir aproximaciones asintóticas, es un
procedimiento sencillo e intuitivo que permite generar inferencia sobre el valor
de pi .
     El caso práctico analizado en este trabajo sobre los resultados del sorteo
Tris de México ha mostrado claramente lo anterior, ya que a pesar de que la
frecuencia de los diferentes dígitos parecía no ser igual (ver tabla 3), ninguna
de las pruebas tradicionales de la subsección 2.2 fue capaz de evidenciar la falta
de aleatoriedad, cosa que sí se logra con base en π(p | X) (ver figuras 1 y
2). Para verificar la aleatoriedad de un juego de números de d dígitos, tam-
bién es necesario verificar la aleatoriedad a través del tiempo. En la literatura
se encontró que esto se hace con base en pruebas de independencia entre en-
sayos sucesivos, y que un procedimiento utilizado se basa en un estadístico χ2
obtenido a partir de los coeficiente de autocorrelación (ver Royal Statistical So-
ciety 2002) y Box & Pierce (1970). Sin embargo, estas pruebas dependen de
supuestos distribucionales y de resultados asintóticos que usualmente requieren
tamaño de muestra grande. Además, cuando estas pruebas detectan falta de
independencia aportan pocos elementos para diagnosticar el origen del prob-
lema. Por ello, y como alternativa se ha propuesto en este trabajo el uso de
la carta de control geométrica con cinco zonas para monitorear la aleatoriedad
de los juegos de número de d dígitos, ya que esto ratifica que no sólo es impor-


                                       20

tante verificar la igualdad de la frecuencia de los dígitos, sino analizar la rapidez
con la que aparece en los diferentes dígitos. La carta de control es intuitiva,
no requiere aproximaciones asintóticas ni supuestos distribucionales adicionales;
además permite actuar oportunamente cuando se detecten resultados o patrones
que evidencien la falta de aleatoriedad.
    De esta manera, el hecho de monitorear la variable Y , que es igual al número
de sorteos para que vuelva a aparecer como resultado un mismo dígito, y llevar
un registro separado para cada dígito permite detectar evidencias del desem-
peño del proceso, e identificar específicamente cuál es la esfera (dígito) que
está teniendo problemas. Para facilitar la interpretación de la carta geométrica
e incrementar la potencia para detectar rachas de puntos que se desvíen de
la aleatoriedad, se propuso dividir la carta en cinco zonas con una cobertura
aproximada de 0,20 cada una (ver tabla 1).
    La aplicación de la carta geométrica propuesta a los datos del sorteo Tris
aportó evidencia adicional contra la falta de aleatoriedad de los dígitos 0 y 9
. Además se detectaron otros problemas para otro par de dígitos (el 3 y el 6
), que aunque en sus frecuencias totales no parecía que tuvieran problemas, la
velocidad con la que aparecieron mostró rachas, donde en un periodo aparecían
más rápido y en el otro fue más lento. Esto se validó con las pruebas estadísticas
propuestas en las expresiones (19) y (20).
    De esta manera, la carta geométrica propuesta resulta un instrumento útil
para monitorear la aleatoriedad de juegos de azar del tipo d dígitos, tanto por
sus propiedades teóricas como por su sencillez y sentido práctico.
    En cierto sentido, los problemas detectados en la aleatoriedad de los resul-
tados del sorteo Tris sorprenden porque la empresa responsable de este sorteo
es una empresa pública que goza de un buen prestigio en México. Pero es
claro que requiere mejores formas de asegurar la aleatoriedad de sus sorteos,
como también lo concluye Coronel-Brizio et al. (2008), al detectar problemas
de aleatoriedad en el sorteo Melate de esta misma empresa, que es un juego del
tipo k/N .
    [Recibido: julio de 2009 - Aceptado: septiembre de 2010]


Referencias
Bernardo J M, Smith A F M. Bayesian Theory.(1994). John Wiley.
Box G E P, Pierce D A. Distribution of Residua Autocorrelations in Autoregressive-Integrated Moving Average Time Series Models.(1970). Journal of the American Statistical Association.
Cai Y, Krishnamoorthy K. Exact Size and Power Properties of Five Tests for Multinomial Proportions.(2006). Communications in Statistics-Simulation and Computation.
Clotfelter C T, Cook P J. The "Gambler’s Fallacy" in Lottery Play.(2008). Management Science.
Coronel-Brizio H, Hernández-Montoya A, Rapallo F, Scalas E. Statistical Auditing and Randomness Test of Lotto k/N -Type Games.(2008). Physica A .
Finkelstein M. Estimating the Frequency Distribution of the Numbers bet on the California Lottery.(1995). Applied Mathematics and Computation.
Genest C, Lockhart R A, Stephens M A.  χ2 and the lottery.(2002). Journal of the Royal Statistical Society: Series D.
Goodman L A. On Simultaneous Confidence Intervals for Multinomial Proportions.(1965). Technometrics.
Gutiérrez H. Cartas de control bayesianas para atributos y el tamaño de subgrupo grande en la carta p.(2006). Revista Colombiana de Estadistica.
Gutiérrez H, de la Vara R. Control estadístico de calidad y seis sigma segunda edn.(2009). McGraw-Hill.
Hou C D, Chiang J, Tai J J. A Family of Simultaneous Confidence Intervals for Multinomial Proportions.(2003). Computational Statistics and 3 Data Analysis.
Joe H. An Ordering of Dependence for Distribution of k-tuples with Applications to Lotto Games.(1987). The Canadian Journal of Statistics.
Joe H. A Winning Strategy for Lotto Games?.(1990). The Canadian Journal of Statistics.
Joe H. Tests of Uniformity for Sets of Lotto Numbers.(1993). Statistics and Probability Letters. 
Johnson R, Klotz J. Estimating hot Numbers and Testing Uniformity for the Lotto.(1993). Journal of the American Statistical Association.
Koning R H, Vermaat M B. A Probabilistic Analysis of the Dutch Lotto.(2002).University of Groningen.
Ljung G M, Box G E P. On a Measure of Lack of Fit in Time Series Models.(1978). Biometrika.
Nass C A G. The 2-test for Small Expectations in Contingency Tables with Special Feference to Accidents and Absenteeism.(1959). Biometrika.
Percy D F. Bayesian Methods for Testing the Randomness of Lottery Draws - Technical report.(2006). University of Salford.
Quesenberry C P, Hurst D C. Large-Sample Simultaneous Confidence Intervals for Multinomial Proportions.(1964). Technometrics.
Royal Statistical Society. Reports on the Randomness of UK Lottery Games.(2000).http://www natlotcomm gov uk.
Royal Statistical Society. Reports on the Randomness of UK Lottery Games.(2002).http://www natlotcomm gov uk
Schwartz D G. Suburban Xanadu: The Casino Resort on the Las Vegas Strip and Beyond.(2003). Routledge.
Schwartz D G. Roll the Bones: The History of Gambling.(2006). Gotham Books.
Sison C P, Glaz J. Simultaneous Confidence Intervals and Sample size Determination for Multinomial Proportions.(1995). Journal of the American Statistical Association.
Stern H, Cover T M. Maximum Entropy and the Lottery.(1989). Journal of the American Statistical Association.
Teo C P, Leong S M. Managing Risk in a Four-Digit Number Game.(2002). SIAM REVIEW.
University of Salford. Randomness of the Lotto Draws: Summary of Findings.(2004). Centre for the Study of Gambling.
University of Salford.Randomness of the Lotto Lucky Dip.(2005).Centre for the Study of Gambling.
University of Salford. Randomness of thunderball draws.(2005). Centre for the Study of Gambling.
Yang Z, Xie M, Kuralmani V, Tsui K L. On the Performance of Geometric Charts with Estimated Control Limits.(2002). Journal of Quality Technology.
